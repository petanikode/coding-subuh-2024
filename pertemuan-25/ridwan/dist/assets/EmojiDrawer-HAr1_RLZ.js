import{v as u}from"./index-B7YkQ0xh.js";import{Q as j,U as h,c as D,O as v,W as x}from"./register-B1JstNQ6.js";import"./bootstrap.esm-BouezZmv.js";function y(d){const{context:o,particle:e,radius:n,opacity:a}=d,t=e.emojiData,r=2,c=n*r,m=o.globalAlpha;t&&(o.globalAlpha=a,o.drawImage(t,-n,-n,c,c),o.globalAlpha=m)}const g='"Twemoji Mozilla", Apple Color Emoji, "Segoe UI Emoji", "Noto Color Emoji", "EmojiOne Color"';class b{constructor(){this._emojiShapeDict=new Map}destroy(){for(const[o,e]of this._emojiShapeDict)e instanceof ImageBitmap&&(e==null||e.close(),this._emojiShapeDict.delete(o))}draw(o){y(o)}async init(o){const e=o.actualOptions;if(!u.find(t=>j(t,e.particles.shape.type)))return;const n=[h(g)],a=u.map(t=>e.particles.shape.options[t]).find(t=>!!t);a&&D(a,t=>{t.font&&n.push(h(t.font))}),await Promise.all(n)}particleDestroy(o){delete o.emojiData}particleInit(o,e){const a=e.shapeData;if(!(a!=null&&a.value))return;const t=v(a.value,e.randomIndexData),r=a.font??g;if(!t)return;const c=`${t}_${r}`,m=this._emojiShapeDict.get(c);if(m){e.emojiData=m;return}const p=x(e.size.value)*2;let f;const l=x(e.size.value);if(typeof OffscreenCanvas<"u"){const s=new OffscreenCanvas(p,p),i=s.getContext("2d");if(!i)return;i.font=`400 ${l*2}px ${r}`,i.textBaseline="middle",i.textAlign="center",i.fillText(t,l,l),f=s.transferToImageBitmap()}else{const s=document.createElement("canvas");s.width=p,s.height=p;const i=s.getContext("2d");if(!i)return;i.font=`400 ${l*2}px ${r}`,i.textBaseline="middle",i.textAlign="center",i.fillText(t,l,l),f=s}this._emojiShapeDict.set(c,f),e.emojiData=f}}export{b as EmojiDrawer};
